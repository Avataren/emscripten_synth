<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Audio Worklet Demo</title>
    <style>
      canvas {
        border: 1px solid black;
        width: 300px;
        height: 200px;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <div id="status">Click canvas to start audio</div>

    <script>
      // First, load the audio processor script
      const processorScript = document.createElement('script');
      processorScript.src = 'audio_processor.js';
      processorScript.async = true;

      // Wait for the module to be ready
      async function init() {
        try {
          await new Promise((resolve, reject) => {
            processorScript.onload = resolve;
            processorScript.onerror = reject;
          });

          if (typeof createModule === 'undefined') {
            throw new Error(
              'createModule not found - script may not have loaded correctly'
            );
          }

          const module = await createModule();
          console.log('WASM Module Initialized');
          window.audioModule = module;
        } catch (error) {
          console.error('Failed to initialize WASM module:', error);
          document.getElementById('status').textContent =
            'Failed to initialize audio system';
        }
      }

      document.body.appendChild(processorScript);
      init();
    </script>
  </body>
</html>
